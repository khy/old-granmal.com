@(
  user: Option[json.JsObject],
  lastNote: Option[json.JsObject]
)(
  implicit request: play.api.mvc.RequestHeader
)

@layout {

  <div id="main">
  </div>

  <script id="new-note-template" type="text/x-handlebars-template">
    <h1>New Note</h1>
  </script>

  <script id="new-book-template" type="text/x-handlebars-template">
    <div class="dialog-header">
      <h1>New Book</h1>
    </div>

    <form>
      <div class="field">
        <input type="text" name="title" placeholder="Title"></input>
      </div>

      <div class="field">
        <input type="text" name="author_name" placeholder="Author" value="{{author_name}}"></input>
      </div>

      <input type="hidden" name="author_guid" value="{{author_guid}}"></input>

      <button type="submit">Add Book</button>
    </form>
  </script>

  <script id="author-selector-template" type="text/x-handlebars-template">
    <div class="dialog-header">
      <h1>Choose Author</h1>
    </div>

    <form class="selector">
      <div class="field">
        <input type="text" name="query" placeholder="Search by name&hellip;" value="{{query}}"></input>
      </div>
    </form>

    <ol class="authors">
      {{#each authors}}
        <li data-guid={{guid}}>{{name}}</li>
      {{/each}}

      {{#if query}}
        <li>
          <a href="#" class="add-author">
            <p class="primary">
              <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
              Add <b>{{query}}</b>
            </p>
          </a>
        </li>
      {{/if}}
    </ol>
  </script>

  @views.html.helper.javascriptRouter("serverRoutes")(
    controllers.bookclub.routes.javascript.Application.findAuthors
  )

  <script>
    define('routers/server', function() {
      return {
        signIn: function() {
          return { url: '/sign-in'};
        },
        findAuthors: serverRoutes.controllers.bookclub.Application.findAuthors
      };
    });

    require(['lib', 'app', 'models/note'], function(lib, App, Note) {
      var user, lastNote;

      @user.map { user =>
        user = @Html(json.Json.stringify(user));
      }

      @lastNote.map { lastNote =>
        lastNote = new Note(@Html(json.Json.stringify(lastNote)));
      }

      window.App = new App({
        user: user,
        lastNote: lastNote
      });

      lib.ensureFullPage();
      window.App.init();
    });
  </script>

}
